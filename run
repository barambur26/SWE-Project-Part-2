#!/usr/bin/env python
import sys
from pathlib import Path

from swe_project.cli import main

ROOT = (
    Path(__file__).resolve().parent
)  # the folder where this "run" file lives (repo root).

# Add "<repo>/src" to the Python import search path.
# Without this, "import swe=_project" would fail because Python doesn't look in src/ by default.
sys.path.insert(0, str(ROOT / "src"))


if __name__ == "__main__":
    # Grab the arguments that come after "./run"
    argv = sys.argv[1:]

    # If exactly one arg is given AND it's not a known subcommand or an option,
    # treat it as the URL file (spec wants "./run URL_FILE").
    if (
        len(argv) == 1
        and not argv[0].startswith("-")  # don't rewrite options like --help
        and argv[0]
        not in {"install", "test", "score"}  # don't rewrite known subcommands
    ):
        p = Path(argv[0])
        # Accept both absolute (spec-required) and relative (convenience) paths.
        # We don’t validate contents here — cli.py handles file errors later.
        if p.is_file() or p.suffix in {".txt", ""}:
            argv = ["score", argv[0]]

    # Call into the CLI's main() with the possibly modified argv.
    # SystemExit ensures we propagate the return code (0 = success, 1 = error).
    raise SystemExit(main(argv))
